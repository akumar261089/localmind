<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>LocalMind Browse</title>
    <link rel="stylesheet" href="css/localmind.css">

    <!-- Markdown & Syntax Highlighting -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script>
        // Inline script to prevent flash of wrong theme
        (function () {
            const theme = localStorage.getItem("localmind_theme") || "dark";
            document.documentElement.setAttribute("data-theme", theme);
        })();
    </script>
</head>

<body>
    <header>
        <a href="index.html" style="color:inherit; text-decoration:none; display:flex; align-items:center; gap:8px;">
            <strong>üß† LocalMind</strong>
        </a>
        <a href="chat.html">Chat</a>
        <button id="themeToggleBtn" class="secondary" style="margin-left:auto; padding:6px 10px;">üé®</button>
    </header>

    <button id="expandSidebarBtn" title="Expand Sidebar">‚û§</button>

    <div id="layout">

        <aside id="sidebar">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <h3>Quick Models</h3>
                <button id="collapseSidebarBtn" class="secondary" style="padding:4px 8px; font-size:0.8rem;">‚óÄ</button>
            </div>
            <div id="quickModelsView"></div>

            <button id="editQuickModelsBtn" class="secondary">Edit Quick Models</button>
            <div id="quickModelsEditor" style="display:none;">
                <textarea id="quickModelsInput" rows="4"></textarea>
                <button id="saveQuickModelsBtn">Save</button>
            </div>

            <hr>

            <select id="modelSelect"></select>
            <button id="loadModelBtn">Load Model</button>

            <hr>

            <textarea id="systemPrompt" rows="4">
You analyze web pages and answer questions using provided context.
    </textarea>
            <label>Temperature <span id="tempVal">0.7</span></label>
            <input type="range" id="temperature" min="0" max="1" step="0.05" value="0.7">

            <label>Max Tokens</label>
            <input type="number" id="maxTokens" value="512">

            <button id="clearChatBtn" class="secondary">Reset Chat</button>
        </aside>

        <main id="main" class="scroll-y">
            <div style="margin-bottom:12px; display:flex; gap:8px;">
                <input id="urlInput" placeholder="https://example.com" />
                <button id="loadPageBtn" class="secondary">Load Frame</button>
                <button id="autoFetchBtn" style="background:var(--accent-hover); box-shadow:var(--shadow-glow);">‚ú®
                    Auto-Read</button>
                <button id="externalLinkBtn" class="secondary" style="display:none;" title="Open in new tab">üîó</button>
            </div>

            <div id="status"></div>
            <div id="tokenStatus"></div>
            <div style="font-size:0.8rem; color:var(--text-muted); margin-bottom:8px;">
                ‚ÑπÔ∏è Note: Many websites (e.g. Wikipedia) block themselves from being loaded here. If the frame below
                is
                blank or shows an error, please use the <strong>Manual Paste</strong> button below.
            </div>

            <!-- Iframe Container with Fallback Overlay option -->
            <div style="position:relative;">
                <iframe id="browserFrame"></iframe>

                <!-- Manual Paste Fallback -->
                <div id="manualContextArea"
                    style="margin-bottom:16px; border:1px solid var(--border-light); padding:12px; border-radius:var(--radius-lg); background:var(--bg-panel); display:none;">
                    <div style="display:flex; justify-content:space-between; margin-bottom:8px;">
                        <strong>Manual Page Content</strong>
                        <small style="color:var(--text-muted)">Paste text here if site blocks iframe</small>
                    </div>
                    <textarea id="manualContextInput" rows="5" placeholder="Copy & Paste text from the website here..."
                        style="width:100%; margin-bottom:8px;"></textarea>
                    <button id="setContextBtn">Set as Context</button>
                </div>

                <div style="text-align:center; margin-bottom:12px;">
                    <button id="togglePasteBtn" class="secondary" style="font-size:0.8rem;">Toggle Manual Paste (Fix
                        for
                        Blocked Sites)</button>
                </div>
            </div>

            <div id="chat" style="flex:1; height:auto; min-height:200px;"></div>

            <div id="inputBar">
                <textarea id="userInput" rows="1" placeholder="Ask about the page..." disabled></textarea>
                <div style="display:flex; flex-direction:column; gap:4px;">
                    <button id="sendBtn" disabled>Send</button>
                    <button id="stopBtn" class="secondary"
                        style="display:none; font-size:0.8rem; padding:4px;">Stop</button>
                </div>
            </div>
        </main>

    </div>

    <script type="module" src="main.browse.js"></script>
</body>

</html>